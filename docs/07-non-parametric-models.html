<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="author" content="Angel Feliz">
<title>Machine Learning with R Notes - 7&nbsp; Non-parametric Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./08-survival-analysis.html" rel="next">
<link href="./06-generative-classification-models.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><link rel="stylesheet" href="summary-format.css">
</head>
<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Machine Learning with R Notes</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
    <a href="https://github.com/AngelFelizR/ISL-Solutuon-Book" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./01-modeling-process.html">Summary Notes</a></li><li class="breadcrumb-item"><a href="./07-non-parametric-models.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Non-parametric Methods</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto"><div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Summary Notes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01-modeling-process.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Strategy to implement machine learning solutions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-feature-engineering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Feature Engineering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-model-performance.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Understanding model performance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-resampling-methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Resampling methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-generalized-linear-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Generalized linear models (GLM)</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-generative-classification-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Generative Models for Classiﬁcation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-non-parametric-models.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Non-parametric Methods</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-survival-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Time-event (Survival) Analysis and Censored Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-unsupervised-learning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Unsupervised Learning</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">ISLR Execices 2nd Edition</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./execises-02.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">02 - Statistical Learning</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./execises-03.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">03 - Linear Regression</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./execises-04.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">04 - Classification</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./execises-05.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">05 - Resampling Methods</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./execises-11.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">11 - Survival Analysis and Censored Data</span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#smoothing-splines" id="toc-smoothing-splines" class="nav-link active" data-scroll-target="#smoothing-splines"><span class="header-section-number">7.1</span> Smoothing splines</a></li>
  <li><a href="#local-regression" id="toc-local-regression" class="nav-link" data-scroll-target="#local-regression"><span class="header-section-number">7.2</span> Local regression</a></li>
  <li>
<a href="#multivariate-adaptive-regression-splines-mars" id="toc-multivariate-adaptive-regression-splines-mars" class="nav-link" data-scroll-target="#multivariate-adaptive-regression-splines-mars"><span class="header-section-number">7.3</span> Multivariate Adaptive Regression Splines (MARS)</a>
  <ul>
<li><a href="#extending-linear-models" id="toc-extending-linear-models" class="nav-link" data-scroll-target="#extending-linear-models"><span class="header-section-number">7.3.1</span> Extending linear models</a></li>
  <li><a href="#explaning-the-model" id="toc-explaning-the-model" class="nav-link" data-scroll-target="#explaning-the-model"><span class="header-section-number">7.3.2</span> Explaning the model</a></li>
  <li>
<a href="#loading-prerequisites" id="toc-loading-prerequisites" class="nav-link" data-scroll-target="#loading-prerequisites"><span class="header-section-number">7.3.3</span> Loading prerequisites</a>
  <ul class="collapse">
<li><a href="#libraries-to-use" id="toc-libraries-to-use" class="nav-link" data-scroll-target="#libraries-to-use">Libraries to use</a></li>
  <li><a href="#data-to-use" id="toc-data-to-use" class="nav-link" data-scroll-target="#data-to-use">Data to use</a></li>
  </ul>
</li>
  <li><a href="#explaning-models-summary" id="toc-explaning-models-summary" class="nav-link" data-scroll-target="#explaning-models-summary"><span class="header-section-number">7.3.4</span> Explaning model’s summary</a></li>
  <li>
<a href="#tuning-process" id="toc-tuning-process" class="nav-link" data-scroll-target="#tuning-process"><span class="header-section-number">7.3.5</span> Tuning Process</a>
  <ul class="collapse">
<li><a href="#caret" id="toc-caret" class="nav-link" data-scroll-target="#caret">Caret</a></li>
  <li><a href="#tidymodels" id="toc-tidymodels" class="nav-link" data-scroll-target="#tidymodels">Tidymodels</a></li>
  </ul>
</li>
  <li><a href="#feature-interpretation" id="toc-feature-interpretation" class="nav-link" data-scroll-target="#feature-interpretation"><span class="header-section-number">7.3.6</span> Feature interpretation</a></li>
  <li><a href="#final-thoughts" id="toc-final-thoughts" class="nav-link" data-scroll-target="#final-thoughts"><span class="header-section-number">7.3.7</span> Final thoughts</a></li>
  </ul>
</li>
  <li>
<a href="#k-nearest-neighbors-knn" id="toc-k-nearest-neighbors-knn" class="nav-link" data-scroll-target="#k-nearest-neighbors-knn"><span class="header-section-number">7.4</span> K-nearest neighbors (KNN)</a>
  <ul>
<li><a href="#classi%EF%AC%81er" id="toc-classiﬁer" class="nav-link" data-scroll-target="#classi%EF%AC%81er"><span class="header-section-number">7.4.1</span> Classiﬁer</a></li>
  <li><a href="#regression" id="toc-regression" class="nav-link" data-scroll-target="#regression"><span class="header-section-number">7.4.2</span> Regression</a></li>
  <li><a href="#pre-processing" id="toc-pre-processing" class="nav-link" data-scroll-target="#pre-processing"><span class="header-section-number">7.4.3</span> Pre-processing</a></li>
  <li><a href="#coding-example" id="toc-coding-example" class="nav-link" data-scroll-target="#coding-example"><span class="header-section-number">7.4.4</span> Coding example</a></li>
  </ul>
</li>
  <li>
<a href="#tree-based-methods" id="toc-tree-based-methods" class="nav-link" data-scroll-target="#tree-based-methods"><span class="header-section-number">7.5</span> Tree-Based Methods</a>
  <ul>
<li>
<a href="#simple-trees" id="toc-simple-trees" class="nav-link" data-scroll-target="#simple-trees"><span class="header-section-number">7.5.1</span> Simple trees</a>
  <ul class="collapse">
<li><a href="#advantages-and-disadvantages" id="toc-advantages-and-disadvantages" class="nav-link" data-scroll-target="#advantages-and-disadvantages">Advantages and disadvantages</a></li>
  <li><a href="#regression-1" id="toc-regression-1" class="nav-link" data-scroll-target="#regression-1">Regression</a></li>
  <li><a href="#classification" id="toc-classification" class="nav-link" data-scroll-target="#classification">Classification</a></li>
  <li><a href="#coding-example-1" id="toc-coding-example-1" class="nav-link" data-scroll-target="#coding-example-1">Coding example</a></li>
  </ul>
</li>
  <li>
<a href="#bagging-bootstrap-aggregation" id="toc-bagging-bootstrap-aggregation" class="nav-link" data-scroll-target="#bagging-bootstrap-aggregation"><span class="header-section-number">7.5.2</span> Bagging (bootstrap aggregation)</a>
  <ul class="collapse">
<li><a href="#out-of-bag-error-estimation" id="toc-out-of-bag-error-estimation" class="nav-link" data-scroll-target="#out-of-bag-error-estimation">Out-of-bag error estimation</a></li>
  <li><a href="#variable-importance-measures" id="toc-variable-importance-measures" class="nav-link" data-scroll-target="#variable-importance-measures">Variable importance measures</a></li>
  </ul>
</li>
  <li>
<a href="#random-forests" id="toc-random-forests" class="nav-link" data-scroll-target="#random-forests"><span class="header-section-number">7.5.3</span> Random Forests</a>
  <ul class="collapse">
<li><a href="#parameters-to-tune" id="toc-parameters-to-tune" class="nav-link" data-scroll-target="#parameters-to-tune">Parameters to tune</a></li>
  </ul>
</li>
  <li>
<a href="#boosting" id="toc-boosting" class="nav-link" data-scroll-target="#boosting"><span class="header-section-number">7.5.4</span> Boosting</a>
  <ul class="collapse">
<li><a href="#parameters-to-tune-1" id="toc-parameters-to-tune-1" class="nav-link" data-scroll-target="#parameters-to-tune-1">Parameters to tune</a></li>
  </ul>
</li>
  <li><a href="#bayesian-additive-regression-trees-bart" id="toc-bayesian-additive-regression-trees-bart" class="nav-link" data-scroll-target="#bayesian-additive-regression-trees-bart"><span class="header-section-number">7.5.5</span> Bayesian additive regression trees (BART)</a></li>
  </ul>
</li>
  <li>
<a href="#support-vector-machine" id="toc-support-vector-machine" class="nav-link" data-scroll-target="#support-vector-machine"><span class="header-section-number">7.6</span> Support Vector Machine</a>
  <ul>
<li><a href="#maximal-margin-classifier-hard-margin-classifier" id="toc-maximal-margin-classifier-hard-margin-classifier" class="nav-link" data-scroll-target="#maximal-margin-classifier-hard-margin-classifier"><span class="header-section-number">7.6.1</span> Maximal Margin Classifier <em>(Hard Margin Classifier)</em></a></li>
  <li><a href="#support-vector-classifiers-soft-margin-classifier" id="toc-support-vector-classifiers-soft-margin-classifier" class="nav-link" data-scroll-target="#support-vector-classifiers-soft-margin-classifier"><span class="header-section-number">7.6.2</span> Support Vector Classifiers <em>(soft margin classifier)</em></a></li>
  <li>
<a href="#non-linear-boundaries" id="toc-non-linear-boundaries" class="nav-link" data-scroll-target="#non-linear-boundaries"><span class="header-section-number">7.6.3</span> Non-linear boundaries</a>
  <ul class="collapse">
<li><a href="#polynomial-svm_poly" id="toc-polynomial-svm_poly" class="nav-link" data-scroll-target="#polynomial-svm_poly">Polynomial (<code>svm_poly</code>)</a></li>
  <li><a href="#radial-svm_rbf" id="toc-radial-svm_rbf" class="nav-link" data-scroll-target="#radial-svm_rbf">Radial (<code>svm_rbf</code>)</a></li>
  <li><a href="#hyperbolic-tangent" id="toc-hyperbolic-tangent" class="nav-link" data-scroll-target="#hyperbolic-tangent">Hyperbolic tangent</a></li>
  </ul>
</li>
  <li><a href="#extending-svms-to-the-k-class-case" id="toc-extending-svms-to-the-k-class-case" class="nav-link" data-scroll-target="#extending-svms-to-the-k-class-case"><span class="header-section-number">7.6.4</span> Extending SVMs to the K-class case</a></li>
  <li><a href="#coding-example-2" id="toc-coding-example-2" class="nav-link" data-scroll-target="#coding-example-2"><span class="header-section-number">7.6.5</span> Coding Example</a></li>
  </ul>
</li>
  </ul></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title">
<span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Non-parametric Methods</span>
</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header><section id="smoothing-splines" class="level2" data-number="7.1"><h2 data-number="7.1" class="anchored" data-anchor-id="smoothing-splines">
<span class="header-section-number">7.1</span> Smoothing splines</h2>
<p>They arise as a result of minimizing a residual sum of squares criterion subject to a smoothness penalty.</p>
<p>In this method rather than trying to minimize <span class="math inline">\(\text{RSS} = \sum_{i=1}^n (y_i - g(x_i))^2\)</span>, we try to find a function <span class="math inline">\(g(x)\)</span>, known as <em>smoothing spline</em>, which could minimize the following expression based on the <span class="math inline">\(\lambda\)</span> <em>nonnegative tuning parameter</em>.</p>
<p><span class="math display">\[
\underbrace{\sum_{i=1}^n (y_i - g(x_i))^2 }_{\text{loss function (data fitting)}} +
\underbrace{\lambda \int g''(t)^2dt}_{\text{penalty term (g varibility)}}
\]</span></p>
<p>The second derivative of <span class="math inline">\(g(t)\)</span> measure how <strong>wiggly</strong> is the function near <span class="math inline">\(t\)</span>, where its value is <span class="math inline">\(0\)</span> when the function is a <em>straight line</em> as a line is <em>perfectly smooth</em>. The we can use <em>integral</em> to get total change in the function <span class="math inline">\(g'(t)\)</span>, over its <em>entire range</em>. As consequence, <strong>the larger the value of</strong> <span class="math inline">\(\mathbf{\lambda}\)</span> <strong>, the smoother</strong> <span class="math inline">\(\mathbf{g}\)</span> <strong>will be</strong>.</p>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>The function <span class="math inline">\(g(x)\)</span> is a <strong>natural cubic spline</strong> with knots at <span class="math inline">\(x_1, \dots ,x_n\)</span>. As results the <em>effective degrees of freedom</em> (<span class="math inline">\(df_{\lambda} = \sum_{i=1}^n \{ \mathbf{S}_{\lambda} \}_{ii}\)</span>) are between <span class="math inline">\(n\)</span> and <span class="math inline">\(2\)</span> depending on the value of <span class="math inline">\(\mathbf{\lambda}\)</span>.</p>
</div>
</div>
</div>
<p>We can use <em>cross-validation</em> to find the best value which can minimize the <strong>RSS</strong>. It turns out that the <strong>leave one-out cross-validation</strong> error (LOOCV) can be computed very eﬃciently for smoothing splines, with essentially the same cost as <strong>computing a single ﬁt</strong>, using the following formula:</p>
<p><span class="math display">\[
\text{RSS}_{cv} (\lambda) = \sum_{i = 1}^n (y_i - \hat{g}_\lambda^{(-i)} (x_i))^2 =
                            \sum_{i = 1}^n \left[ \frac{y_i - \hat{g}_{\lambda} (x_i)}
                                                       {1 - \{ \mathbf{S_{\lambda}} \}_{ii}}
                                           \right]^2
\]</span></p>
<p>Where:</p>
<ul>
<li>
<span class="math inline">\(\hat{g}_\lambda^{(-i)}\)</span>: Refers to the function fitted without the <em>i</em>th observation <span class="math inline">\((x_i, y_i)\)</span>.</li>
<li>
<span class="math inline">\(\hat{g}_\lambda\)</span>: Refers the smoothing spline function ﬁtted to all of the training observations.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/41-smoothing-splines-example.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section><section id="local-regression" class="level2" data-number="7.2"><h2 data-number="7.2" class="anchored" data-anchor-id="local-regression">
<span class="header-section-number">7.2</span> Local regression</h2>
<p>Computes the fit at target point <span class="math inline">\(x_0\)</span> using only the nearly training observations by:</p>
<ol type="1">
<li>Gather the <span class="math inline">\(s=k/n\)</span> closest (known as <em><strong>span</strong>) fraction of points. This step is very important as it controls the flexibility level can be selected using </em>cross-validation*.</li>
<li>Assign a weight <span class="math inline">\(K_{i0} = K(x_i, x_0)\)</span> for each selected point based on the distance to <span class="math inline">\(x_0\)</span>. As lower is the distance as higher needs to be the weight.</li>
<li>Find the coefficients which minimize the <em>weighted least squares regression</em> for the current <span class="math inline">\(x_0\)</span> value.</li>
</ol>
<p><span class="math display">\[
\sum_{i=1}^n = K_{i0}(y_i - \beta_0 - \beta_1x_i)^2
\]</span></p>
<ol start="4" type="1">
<li>Calculate the fitted value of <span class="math inline">\(x_0\)</span> using <span class="math inline">\(\hat{f}(x_0) = \hat{\beta}_0 + \hat{\beta}_1x_0\)</span>.</li>
</ol>
<p>In the next illustration we can see how the model works with some simulated data.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/42-local_regression.png" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="callout callout-style-simple callout-note">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>It performs poorly when we have more than 3 or 4 predictors in our model.</p>
</div>
</div>
</div>
</section><section id="multivariate-adaptive-regression-splines-mars" class="level2" data-number="7.3"><h2 data-number="7.3" class="anchored" data-anchor-id="multivariate-adaptive-regression-splines-mars">
<span class="header-section-number">7.3</span> Multivariate Adaptive Regression Splines (MARS)</h2>
<p><br><br></p>
<table class="table">
<colgroup>
<col style="width: 44%">
<col style="width: 55%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Lineal models</th>
<th style="text-align: left;">Nonlinear models</th>
</tr></thead>
<tbody><tr class="odd">
<td style="text-align: left;">If you know <strong>a priori</strong> the nature of a nonlinear relation you could <strong>manually adapt the model</strong> to take in consideration the nonlinear patters by including <em>polynomial terms</em> or <em>step functions</em>
</td>
<td style="text-align: left;">The model would find the important nonlinear interactions present in the data</td>
</tr></tbody>
</table>
<section id="extending-linear-models" class="level3" data-number="7.3.1"><h3 data-number="7.3.1" class="anchored" data-anchor-id="extending-linear-models">
<span class="header-section-number">7.3.1</span> Extending linear models</h3>
<ul>
<li>
<strong>Polynomial regression</strong>: It extends the <em>linear model</em> by adding extra predictors, obtained by <em>raising each of the original predictors to a power</em>. Generally speaking, it is unusual to use <span class="math inline">\(d\)</span> greater than 3 or 4 as the larger <span class="math inline">\(d\)</span> becomes, the easier the function fit becomes <strong>overly flexible</strong> and oddly shaped as it tends to increase the presence of <strong>multicollinearity</strong>.</li>
</ul>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1 x_i + \beta_2 x_i^2 + \beta_3 x_i^3 + \dots + \beta_d x_i^d + \epsilon_i
\]</span></p>
<ul>
<li>
<strong>Piecewise constant regression</strong>: It’s a <strong>step function</strong> which breaks the range of <span class="math inline">\(X\)</span> into bins and fit a simple constant (e.g., the mean response) in each bin.</li>
</ul>
<p>If we define the cutpoints as <span class="math inline">\(c_1, c_2, \dots, c_K\)</span> in the range of <em>X</em>, we can create <em>dummy variables</em> to represent each range. For example, if <span class="math inline">\(c_1 \leq x_i &lt; c_2\)</span> is <code>TRUE</code> then <span class="math inline">\(C_1(x_i) = 1\)</span> and then we need to repeat that process for each value of <span class="math inline">\(X\)</span> and range. As result we can fit a <em>lineal regression</em> based on the new variables.</p>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1 C_1(x_i) + \beta_2 C_2(x_i)  \dots + \beta_K C_K(x_i) + \epsilon_i
\]</span></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/109-nonlinear-comparisons.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section><section id="explaning-the-model" class="level3" data-number="7.3.2"><h3 data-number="7.3.2" class="anchored" data-anchor-id="explaning-the-model">
<span class="header-section-number">7.3.2</span> Explaning the model</h3>
<p>MARS is an algorithm that <strong>automatically creates a piecewise linear model</strong> after grasping the concept of multiple linear regression.</p>
<p>It will first look for the <strong>single point across the range of </strong><span class="math inline">\(X\)</span> values where two different linear relationships between <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span> achieve the smallest error (e.g., Sum of Squares Error). What results is known as a hinge function <span class="math inline">\(h(x-a)\)</span>, where <span class="math inline">\(a\)</span> is the <strong>cutpoint value</strong> (<em>knot</em>).</p>
<p>For example, let’s use <span class="math inline">\(1.183606\)</span> the our first knot.</p>
<p><span class="math display">\[
y =
\begin{cases}
\beta_0 + \beta_1(1.183606 - x) &amp; x &lt; 1.183606, \\
\beta_0 + \beta_1(x - 1.183606) &amp; x &lt; 1.183606 \\
\end{cases}
\]</span></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/110-mars-one-knot.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Once the first knot has been found, the search continues for a second knot.</p>
<p><span class="math display">\[
y =
\begin{cases}
\beta_0 + \beta_1(1.183606 - x) &amp; x &lt; 1.183606, \\
\beta_0 + \beta_1(x - 1.183606) &amp; x &lt; 1.183606 \quad \&amp; \quad x &lt; 4.898114 \\
\beta_0 + \beta_1(4.898114 - x) &amp; x &gt; 4.898114
\end{cases}
\]</span></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/111-mars-two-knots.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>This procedure continues until <span class="math inline">\(R^2\)</span> change by less than 0.001.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/112-mars-3-to-4-knots.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>Then the model starts the <strong>pruning</strong> process, which consist in using <strong>cross-validation</strong> to remove knots that do not contribute significantly to predictive accuracy. To be more specific the package used in <code>R</code> performs a <strong>Generalized cross-validation</strong> which is a <strong>shortcut</strong> for linear models that produces an <strong>approximate leave-one-out cross-validation</strong> error metric.</p>
</section><section id="loading-prerequisites" class="level3" data-number="7.3.3"><h3 data-number="7.3.3" class="anchored" data-anchor-id="loading-prerequisites">
<span class="header-section-number">7.3.3</span> Loading prerequisites</h3>
<p>We can fit a direct engine MARS model with the <code>earth</code> (Enhanced Adaptive Regression Through Hinges) package, as “MARS” is trademarked and licensed exclusively to <em>Salford Systems</em> and cannot be used for <em>competing software solutions</em>.</p>
<section id="libraries-to-use" class="level4"><h4 class="anchored" data-anchor-id="libraries-to-use">Libraries to use</h4>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Helper packages for data wrangling and awesome plotting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/recipes">recipes</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>   </span>
<span></span>
<span><span class="co"># Modeling packages for fitting MARS models</span></span>
<span><span class="co"># and automating the tuning process</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.milbo.users.sonic.net/earth/">earth</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rsample.tidymodels.org">rsample</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/parsnip">parsnip</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Model interpretability packages</span></span>
<span><span class="co"># for variable importance and relationships</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/koalaverse/vip/">vip</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bgreenwell/pdp">pdp</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="data-to-use" class="level4"><h4 class="anchored" data-anchor-id="data-to-use">Data to use</h4>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_split</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">initial_split</a></span><span class="op">(</span></span>
<span>    <span class="fu">AmesHousing</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/AmesHousing/man/make_ames.html">make_ames</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>    prop <span class="op">=</span> <span class="fl">0.7</span>, </span>
<span>    strata <span class="op">=</span> <span class="st">"Sale_Price"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">ames_train</span>  <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">training</a></span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span>
<span><span class="va">ames_test</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">testing</a></span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="explaning-models-summary" class="level3" data-number="7.3.4"><h3 data-number="7.3.4" class="anchored" data-anchor-id="explaning-models-summary">
<span class="header-section-number">7.3.4</span> Explaning model’s summary</h3>
<p>Let’s explain the summary of a trained model.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mars1</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/earth/man/earth.html">earth</a></span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span></span>
<span></span>
<span><span class="va">mars1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Selected 41 of 45 terms, and 29 of 308 predictors
Termination condition: RSq changed by less than 0.001 at 45 terms
Importance: Gr_Liv_Area, Year_Built, Total_Bsmt_SF, ...
Number of terms at each degree of interaction: 1 40 (additive model)
GCV 511589986    RSS 967008439675    GRSq 0.9207836    RSq 0.9268516</code></pre>
</div>
</div>
<ol type="1">
<li>The number of terms correspond to the number of coefficients used by the model.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="va">mars1</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 41</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">mars1</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        Sale_Price
(Intercept)           227597.23167
h(Gr_Liv_Area-3194)     -287.99337
h(3194-Gr_Liv_Area)      -58.61227
h(Year_Built-2002)      3128.13737
h(2002-Year_Built)      -450.63697
h(Total_Bsmt_SF-2223)   -653.13097
h(2223-Total_Bsmt_SF)    -29.03002</code></pre>
</div>
</div>
<ol start="2" type="1">
<li>The number of predictors is counted after transforming all factors into dummy variables.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html">step_dummy</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_nominal_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html">prep</a></span><span class="op">(</span>training <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/bake.html">bake</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Sale_Price</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 308</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>Shows the path used by <code>earth</code> to select the model with different metrics</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">mars1</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07-non-parametric-models_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>It’s also important to point out that this package has the capacity to assess potential interactions between different hinge functions.</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/earth/man/earth.html">earth</a></span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, </span>
<span>      data <span class="op">=</span> <span class="va">ames_train</span>,</span>
<span>      degree <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="op">(</span>\<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span><span class="op">$</span><span class="va">coefficients</span><span class="op">)</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                          Sale_Price
(Intercept)                             3.473694e+05
h(Gr_Liv_Area-3194)                     2.302940e+02
h(3194-Gr_Liv_Area)                    -7.005261e+01
h(Year_Built-2002)                      5.242461e+03
h(2002-Year_Built)                     -7.360079e+02
h(Total_Bsmt_SF-2223)                   1.181093e+02
h(2223-Total_Bsmt_SF)                  -4.901140e+01
h(Year_Built-2002)*h(Gr_Liv_Area-2398)  9.035037e+00
h(Year_Built-2002)*h(2398-Gr_Liv_Area) -3.382639e+00
h(Bsmt_Unf_SF-625)*h(3194-Gr_Liv_Area) -1.145129e-02</code></pre>
</div>
</div>
</section><section id="tuning-process" class="level3" data-number="7.3.5"><h3 data-number="7.3.5" class="anchored" data-anchor-id="tuning-process">
<span class="header-section-number">7.3.5</span> Tuning Process</h3>
<p>There are two important tuning parameters associated with our MARS model:</p>
<ul>
<li>
<code>degree</code>: the maximum degree of interactions, where rarely is there any benefit in assessing greater than <em>3-rd degree interactions</em>.</li>
<li>
<code>nprune</code>: Maximum number of terms (including intercept) in the pruned model, where you can start out with <em>10 evenly spaced values</em>.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># create a tuning grid</span></span>
<span><span class="va">hyper_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span></span>
<span>  degree <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, </span>
<span>  nprune <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">100</span>, length.out <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html">floor</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">hyper_grid</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  degree nprune
1      1      2
2      2      2
3      3      2
4      1     12
5      2     12
6      3     12</code></pre>
</div>
</div>
<section id="caret" class="level4"><h4 class="anchored" data-anchor-id="caret">Caret</h4>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Cross-validated model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>  <span class="co"># for reproducibility</span></span>
<span><span class="va">cv_mars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">ames_train</span>, select <span class="op">=</span> <span class="op">-</span><span class="va">Sale_Price</span><span class="op">)</span>,</span>
<span>  y <span class="op">=</span> <span class="va">ames_train</span><span class="op">$</span><span class="va">Sale_Price</span>,</span>
<span>  method <span class="op">=</span> <span class="st">"earth"</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"RMSE"</span>,</span>
<span>  trControl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"cv"</span>, number <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  tuneGrid <span class="op">=</span> <span class="va">hyper_grid</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># View results</span></span>
<span><span class="va">cv_mars</span><span class="op">$</span><span class="va">bestTune</span></span>
<span><span class="co">##    nprune degree</span></span>
<span><span class="co">## 16     45      2</span></span>
<span></span>
<span></span>
<span><span class="va">cv_mars</span><span class="op">$</span><span class="va">results</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">nprune</span> <span class="op">==</span> <span class="va">cv_mars</span><span class="op">$</span><span class="va">bestTune</span><span class="op">$</span><span class="va">nprune</span>, </span>
<span>         <span class="va">degree</span> <span class="op">==</span> <span class="va">cv_mars</span><span class="op">$</span><span class="va">bestTune</span><span class="op">$</span><span class="va">degree</span><span class="op">)</span></span>
<span><span class="co">#   degree nprune     RMSE  Rsquared     MAE RMSESD RsquaredSD    MAESD</span></span>
<span><span class="co"># 1      2     45 23427.47 0.9156561 15767.9 1883.2 0.01365285 794.2688</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cv_mars</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/113-cv-mars-plot.png" class="img-fluid figure-img"></p>
</figure>
</div>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cv_mars</span><span class="op">$</span><span class="va">resample</span><span class="op">$</span><span class="va">RMSE</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#  Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co"># 20735   22053   23189   23427   24994   26067 </span></span>
<span></span>
<span></span>
<span><span class="va">cv_mars</span><span class="op">$</span><span class="va">resample</span></span>
<span><span class="co">#        RMSE  Rsquared      MAE Resample</span></span>
<span><span class="co"># 1  23243.22 0.9387415 15777.98   Fold04</span></span>
<span><span class="co"># 2  23044.17 0.9189506 15277.56   Fold03</span></span>
<span><span class="co"># 3  23499.99 0.9205506 16190.29   Fold07</span></span>
<span><span class="co"># 4  23135.62 0.9226565 16106.93   Fold01</span></span>
<span><span class="co"># 5  25491.41 0.8988816 16255.55   Fold05</span></span>
<span><span class="co"># 6  21414.96 0.9202359 15987.68   Fold08</span></span>
<span><span class="co"># 7  21722.58 0.9050642 14694.66   Fold02</span></span>
<span><span class="co"># 8  26066.88 0.8938272 16635.14   Fold06</span></span>
<span><span class="co"># 9  20735.28 0.9274782 14226.06   Fold10</span></span>
<span><span class="co"># 10 25920.58 0.9101751 16527.20   Fold09</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="tidymodels" class="level4"><h4 class="anchored" data-anchor-id="tidymodels">Tidymodels</h4>
<p>The main benefit of using <code>tidymodels</code> to perform 10-CV is that you can stratify the folds, which can be very useful taking in consideration that the target variable is <em>right-skewed</em>.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">ames_train</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"blue"</span>, alpha <span class="op">=</span> <span class="fl">0.6</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07-non-parametric-models_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol type="1">
<li>Define the model to train</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mars_model</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/mars.html">mars</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html">set_mode</a></span><span class="op">(</span><span class="st">"regression"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span><span class="op">(</span><span class="st">"earth"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html">set_args</a></span><span class="op">(</span>nprune <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>           degree <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="2" type="1">
<li>Define the recipe to use</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mars_recipe</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/recipe.html">recipe</a></span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/step_dummy.html">step_dummy</a></span><span class="op">(</span><span class="fu"><a href="https://recipes.tidymodels.org/reference/has_role.html">all_nominal_predictors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://recipes.tidymodels.org/reference/prep.html">prep</a></span><span class="op">(</span>training <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Create a <code>workflow</code> object to join the model and recipe.</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mars_wf</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">workflows</span><span class="fu">::</span><span class="fu"><a href="https://workflows.tidymodels.org/reference/workflow.html">workflow</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">workflows</span><span class="fu">::</span><span class="fu"><a href="https://workflows.tidymodels.org/reference/add_recipe.html">add_recipe</a></span><span class="op">(</span><span class="va">mars_recipe</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">workflows</span><span class="fu">::</span><span class="fu"><a href="https://workflows.tidymodels.org/reference/add_model.html">add_model</a></span><span class="op">(</span><span class="va">mars_model</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="4" type="1">
<li>Create the folds with <code>rsample</code>
</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_folds</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rsample.tidymodels.org/reference/vfold_cv.html">vfold_cv</a></span><span class="op">(</span><span class="va">ames_train</span>,</span>
<span>           v <span class="op">=</span> <span class="fl">10</span>,</span>
<span>           strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="5" type="1">
<li>Getting metrics for each resample</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mars_rs_fit</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">mars_wf</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/tune_grid.html">tune_grid</a></span><span class="op">(</span>resamples <span class="op">=</span> <span class="va">ames_folds</span>,</span>
<span>                  grid <span class="op">=</span> <span class="va">hyper_grid</span>,</span>
<span>                  metrics <span class="op">=</span> <span class="fu">yardstick</span><span class="fu">::</span><span class="fu"><a href="https://yardstick.tidymodels.org/reference/metric_set.html">metric_set</a></span><span class="op">(</span><span class="fu">yardstick</span><span class="fu">::</span><span class="va"><a href="https://yardstick.tidymodels.org/reference/rmse.html">rmse</a></span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="6" type="1">
<li>Check the winner’s parameters</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mars_rs_fit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/show_best.html">show_best</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">'rmse'</span>, n <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#   nprune degree .metric .estimator   mean     n std_err .config              </span></span>
<span><span class="co">#    &lt;dbl&gt;  &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                </span></span>
<span><span class="co"># 1      2      1 rmse    standard   25808.    10   1378. Preprocessor1_Model01</span></span>
<span><span class="co"># 2      2      2 rmse    standard   25808.    10   1378. Preprocessor1_Model02</span></span>
<span><span class="co"># 3      2      3 rmse    standard   25808.    10   1378. Preprocessor1_Model03</span></span>
<span></span>
<span></span>
<span><span class="va">final_mars_wf</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">mars_rs_fit</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/show_best.html">select_best</a></span><span class="op">(</span>metric <span class="op">=</span> <span class="st">'rmse'</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">tune</span><span class="fu">::</span><span class="fu"><a href="https://tune.tidymodels.org/reference/finalize_model.html">finalize_workflow</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">mars_wf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ══ Workflow ════════════════════════════════</span></span>
<span><span class="co"># Preprocessor: Recipe</span></span>
<span><span class="co"># Model: mars()</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># ── Preprocessor ────────────────────────────</span></span>
<span><span class="co"># 1 Recipe Step</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># • step_dummy()</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># ── Model ───────────────────────────────────</span></span>
<span><span class="co"># MARS Model Specification (regression)</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Engine-Specific Arguments:</span></span>
<span><span class="co">#   nprune = 2</span></span>
<span><span class="co">#   degree = 1</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Computational engine: earth </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="feature-interpretation" class="level3" data-number="7.3.6"><h3 data-number="7.3.6" class="anchored" data-anchor-id="feature-interpretation">
<span class="header-section-number">7.3.6</span> Feature interpretation</h3>
<p>The <code>vip</code> package importance will measure the impact of the prediction error as a proportion of the total error features are included (<em>Generalized cross-validation</em>).</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># variable importance plots</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://koalaverse.github.io/vip/reference/vip.html">vip</a></span><span class="op">(</span><span class="va">cv_mars</span>, num_features <span class="op">=</span> <span class="fl">40</span>, geom <span class="op">=</span> <span class="st">"point"</span>, value <span class="op">=</span> <span class="st">"gcv"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"GCV"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://koalaverse.github.io/vip/reference/vip.html">vip</a></span><span class="op">(</span><span class="va">cv_mars</span>, num_features <span class="op">=</span> <span class="fl">40</span>, geom <span class="op">=</span> <span class="st">"point"</span>, value <span class="op">=</span> <span class="st">"rss"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"RSS"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/114-vip-plot.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>However, it does not measure the impact for particular hinge functions created for a given feature. To see the effect we need to create a plot for each predictor.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Construct partial dependence plots</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/pdp/man/partial.html">partial</a></span><span class="op">(</span><span class="va">cv_mars</span>, pred.var <span class="op">=</span> <span class="st">"Gr_Liv_Area"</span>, grid.resolution <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/pdp/man/partial.html">partial</a></span><span class="op">(</span><span class="va">cv_mars</span>, pred.var <span class="op">=</span> <span class="st">"Year_Built"</span>, grid.resolution <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p3</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/pdp/man/partial.html">partial</a></span><span class="op">(</span><span class="va">cv_mars</span>, pred.var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Gr_Liv_Area"</span>, <span class="st">"Year_Built"</span><span class="op">)</span>, </span>
<span>          grid.resolution <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/pdp/man/plotPartial.html">plotPartial</a></span><span class="op">(</span>levelplot <span class="op">=</span> <span class="cn">FALSE</span>, zlab <span class="op">=</span> <span class="st">"yhat"</span>, drape <span class="op">=</span> <span class="cn">TRUE</span>, colorkey <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>              screen <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>z <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>, x <span class="op">=</span> <span class="op">-</span><span class="fl">60</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Display plots side by side</span></span>
<span><span class="fu">gridExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span><span class="op">(</span><span class="va">p1</span>, <span class="va">p2</span>, <span class="va">p3</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/115-pdp-plot.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section><section id="final-thoughts" class="level3" data-number="7.3.7"><h3 data-number="7.3.7" class="anchored" data-anchor-id="final-thoughts">
<span class="header-section-number">7.3.7</span> Final thoughts</h3>
<p>Pros:</p>
<ul>
<li>Naturally handles <em>mixed types of predictors</em> (quantitative and qualitative)</li>
<li>Requires <em>minimal feature engineering</em>
</li>
<li>Performs automated <em>feature selection</em>
</li>
<li>Highly **correlated predictors* do not impede predictive accuracy</li>
<li>Finds the important nonlinear interactions present in the data</li>
</ul>
<p>Cons:</p>
<ul>
<li>Slower to train</li>
<li>Correlated predictors can make model interpretation difficult</li>
</ul></section></section><section id="k-nearest-neighbors-knn" class="level2" data-number="7.4"><h2 data-number="7.4" class="anchored" data-anchor-id="k-nearest-neighbors-knn">
<span class="header-section-number">7.4</span> K-nearest neighbors (KNN)</h2>
<p>It uses the principle of nearest neighbors to classify unlabeled examples by using the <strong>Euclidean Distance</strong> to calculate distance between the point we want to predict and <span class="math inline">\(k\)</span> closest neighbors on the training data.</p>
<p><span class="math display">\[
d\left( a,b\right)   = \sqrt {\sum _{i=1}^{p}  \left( a_{i}-b_{i}\right)^2 }
\]</span></p>
<p>KNN unlike parametric models does not tell us which predictors are important, making it hard to make inferences using this model.</p>
<p>This method performs worst than a parametric as we starting adding <em>noise</em> predictors. In fact, we will get in the situation where for a given observation has no <em>nearby neighbors</em>, known as <strong>curse of dimensionality</strong> and leading to a very poor prediction of <span class="math inline">\(f(x_{0})\)</span>.</p>
<section id="classiﬁer" class="level3" data-number="7.4.1"><h3 data-number="7.4.1" class="anchored" data-anchor-id="classiﬁer">
<span class="header-section-number">7.4.1</span> Classiﬁer</h3>
<p>The next function estimates the conditional probability for class <span class="math inline">\(j\)</span> as the fraction of points in <span class="math inline">\(N_{0}\)</span> whose response values equal <span class="math inline">\(j\)</span>.</p>
<p><span class="math display">\[
\text{Pr}(Y = j|X = x_{0}) = \frac{1}{K}
                      \displaystyle\sum_{i \in N_{0}} I(y_{i} = j)
\]</span></p>
<ul>
<li>Where
<ul>
<li>
<span class="math inline">\(j\)</span> response value to test</li>
<li>
<span class="math inline">\(x_{0}\)</span> is the test observation</li>
<li>
<span class="math inline">\(K\)</span> the number of points in the training data that are closest to <span class="math inline">\(x_{0}\)</span> and reduce the model flexibility</li>
<li>
<span class="math inline">\(N_{0}\)</span> points in the training data that are closest to <span class="math inline">\(x_{0}\)</span>
</li>
</ul>
</li>
</ul>
<p>Then KNN classiﬁes the test observation <span class="math inline">\(x_{0}\)</span> to the class with the largest probability.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/08-knn-classifier.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section><section id="regression" class="level3" data-number="7.4.2"><h3 data-number="7.4.2" class="anchored" data-anchor-id="regression">
<span class="header-section-number">7.4.2</span> Regression</h3>
<p>KNN regression estimates <span class="math inline">\(f(x_{0})\)</span> using the average of all the training responses in <span class="math inline">\(N_{0}\)</span>.</p>
<p><span class="math display">\[
\hat{f}(x_{0}) = \frac{1}{K}
                      \displaystyle\sum_{i \in N_{0}} y_{i}
\]</span></p>
<ul>
<li>Where
<ul>
<li>
<span class="math inline">\(x_{0}\)</span> is the test observation</li>
<li>
<span class="math inline">\(K\)</span> the number of points in the training data that are closest to <span class="math inline">\(x_{0}\)</span> and reduce the model flexibility</li>
<li>
<span class="math inline">\(N_{0}\)</span> points in the training data that are closest to <span class="math inline">\(x_{0}\)</span>
</li>
</ul>
</li>
</ul></section><section id="pre-processing" class="level3" data-number="7.4.3"><h3 data-number="7.4.3" class="anchored" data-anchor-id="pre-processing">
<span class="header-section-number">7.4.3</span> Pre-processing</h3>
<p>To use this method we need to make sure that all our variables are numeric. If one our variables is a factor we need to perform a dummy transformation of that variable with the <code><a href="https://recipes.tidymodels.org/reference/step_dummy.html">recipes::step_dummy</a></code> function.</p>
<p>On the other hand, as this model uses distances to make predicts it’s important to check that each feature of the input data is measured with <strong>the same range of values</strong> with the <code><a href="https://recipes.tidymodels.org/reference/step_range.html">recipes::step_range</a></code> function which normalize from 0 to 1 as happens with the dummy function.</p>
<p><span class="math display">\[
x' = \frac{x - \min(x)}{\max(x) - \min(x)}
\]</span></p>
<p>Another normalization alternative is centering the predictors in <span class="math inline">\(\overline{x} = 0\)</span> with <span class="math inline">\(S = 0\)</span> with the function <code><a href="https://recipes.tidymodels.org/reference/step_normalize.html">recipes::step_normalize</a></code> or the function <code><a href="https://rdrr.io/r/base/scale.html">scale()</a></code> which apply the <a href="https://developers.google.com/machine-learning/data-prep/transform/normalization">z-score normalization</a>.</p>
<p><span class="math display">\[
x' = \frac{x - \mu}{\sigma}
\]</span></p>
</section><section id="coding-example" class="level3" data-number="7.4.4"><h3 data-number="7.4.4" class="anchored" data-anchor-id="coding-example">
<span class="header-section-number">7.4.4</span> Coding example</h3>
<p>To perform <strong>K-Nearest Neighbors</strong> we just need to create the model specification by using <strong>kknn</strong> engine.</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.statlearning.com">ISLR2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">Smarket_train</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">Smarket</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">!=</span> <span class="fl">2005</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Smarket_test</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">Smarket</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">Year</span> <span class="op">==</span> <span class="fl">2005</span><span class="op">)</span></span>
<span></span>
<span><span class="va">knn_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/nearest_neighbor.html">nearest_neighbor</a></span><span class="op">(</span>neighbors <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html">set_mode</a></span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span><span class="op">(</span><span class="st">"kknn"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">SmarketKnnPredictions</span> <span class="op">&lt;-</span></span>
<span>  <span class="va">knn_spec</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html">fit</a></span><span class="op">(</span><span class="va">Direction</span> <span class="op">~</span> <span class="va">Lag1</span> <span class="op">+</span> <span class="va">Lag2</span>, data <span class="op">=</span> <span class="va">Smarket_train</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span>new_data <span class="op">=</span> <span class="va">Smarket_test</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">conf_mat</span><span class="op">(</span><span class="va">SmarketKnnPredictions</span>, truth <span class="op">=</span> <span class="va">Direction</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Truth
Prediction Down Up
      Down   43 58
      Up     68 83</code></pre>
</div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">accuracy</span><span class="op">(</span><span class="va">SmarketKnnPredictions</span>, truth <span class="op">=</span> <span class="va">Direction</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary           0.5</code></pre>
</div>
</div>
</section></section><section id="tree-based-methods" class="level2" data-number="7.5"><h2 data-number="7.5" class="anchored" data-anchor-id="tree-based-methods">
<span class="header-section-number">7.5</span> Tree-Based Methods</h2>
<p>These methods involve <strong>stratifying the predictor</strong> space into a number of <em>simple regions</em> and then use mean or the mode response value for the training observations in the region to which it belongs.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/48-Hitters-salary-regression-tree-regions.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>As these results can be summarized in a tree, these types of approaches are known as <strong>decision tree</strong> methods, we have some important parts:</p>
<ul>
<li>
<em>Terminal nodes</em> (<em>leaves</em>) are represented by <span class="math inline">\(R_1\)</span>, <span class="math inline">\(R_2\)</span> and <span class="math inline">\(R_3\)</span>.</li>
<li>
<em>Internal nodes</em> refers to the points along the tree where the predictor space is split.</li>
<li>
<em>Branches</em> refer to the segments of the trees that connect the nodes.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/47-Hitters-salary-regression-tree.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>It’s important to take in consideration that the order in which is presented each predictors also explain the level of importance of each variable. For example, the number of <code>Years</code> has a higher effect over the player’s salary than the number of <code>Hits</code>.</p>
<section id="simple-trees" class="level3" data-number="7.5.1"><h3 data-number="7.5.1" class="anchored" data-anchor-id="simple-trees">
<span class="header-section-number">7.5.1</span> Simple trees</h3>
<section id="advantages-and-disadvantages" class="level4"><h4 class="anchored" data-anchor-id="advantages-and-disadvantages">Advantages and disadvantages</h4>
<table class="table">
<colgroup>
<col style="width: 43%">
<col style="width: 56%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Advantages</th>
<th style="text-align: left;">Disadvantages</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Simpler to explain than linear regression thanks to its graphical representation</td>
<td style="text-align: left;">Small change in the data can cause a large change in the final estimated tree</td>
</tr>
<tr class="even">
<td style="text-align: left;">It doesn’t need much preprocessing as: <br> - It handles qualitative predictors. <br> - It doesn’t require feature scaling or normalization. <br> - It can handle missing values and outliers</td>
<td style="text-align: left;">They aren’t so very good predicting results as: <br> - It prones to overfitting. <br> - It presents low accuracy.</td>
</tr>
<tr class="odd">
<td style="text-align: left;">It can be used for <strong>feature selection</strong> by defining the importance of a feature based on <strong>how early it appears</strong> in the tree and <strong>how often</strong> it is used for splitting</td>
<td style="text-align: left;">They can be biased towards the majority class in imbalanced datasets</td>
</tr>
</tbody>
</table></section><section id="regression-1" class="level4"><h4 class="anchored" data-anchor-id="regression-1">Regression</h4>
<p>To create a decision tree we need to find the regions <span class="math inline">\(R_1, \dots, R_j\)</span> that minimize the RSS where <span class="math inline">\(\hat{y}_{R_j}\)</span> represent the mean response for the training observations within the <em>j</em>th box:</p>
<p><span class="math display">\[
RSS = \sum_{j=1}^J \sum_{i \in R_j} (y_i - \hat{y}_{R_j})^2
\]</span></p>
<p>To define the regions we use the <strong>recursive binary splitting</strong>, which consist the predictor <span class="math inline">\(X_j\)</span> and the cutpoint <span class="math inline">\(s\)</span> leads to the greatest possible reduction in RSS. Next, we repeat the process, looking for the best predictor and best cutpoint in order to split the data further so as to minimize the RSS within each of the resulting regions. The process continues until a <em>stopping criterion is reached</em> (no region contains more than five observations).</p>
<p>This method is:</p>
<ul>
<li><p><em>Top-down</em>: It begins at the <em>top of the tree</em> (where all observations belong to a single region) and then successively splits the predictor space.</p></li>
<li><p><em>Greedy</em>: At each step of the tree-building process, <strong>the best split is made at that particular step</strong>, rather than looking ahead and picking a split that will lead to a better tree in some future step.</p></li>
</ul>
<p>As result, we could end with a very complex tree that <strong>overfits</strong> the data. To solve this, we need <strong>prune</strong> the original tree until getting a <strong>subtree</strong> that leads to the lowest test error rate by using the <strong>cost complexity pruning</strong> approach which creates differente trees based on <span class="math inline">\(\alpha\)</span>.</p>
<p><span class="math display">\[
\sum_{m=1}^{|T|} \sum_{i: x_i \in R_m} (y_i - \hat{y}_{R_m}) ^2  + \alpha|T|
\]</span></p>
<p>Where:</p>
<ul>
<li>
<span class="math inline">\(\alpha\)</span>: Tunning parameter <span class="math inline">\([0,\infty]\)</span> selected using <em>k-cross validation</em>
</li>
<li>
<span class="math inline">\(|T|\)</span>: Number of terminal nodes of the tree <span class="math inline">\(T\)</span>.</li>
<li>
<span class="math inline">\(R_m\)</span>: The subset of predictor space corresponding to the <span class="math inline">\(m\)</span>th terminal node</li>
<li>
<span class="math inline">\(\hat{y}_{R_m}\)</span>: Predicted response associated with <span class="math inline">\(R_m\)</span>
</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/49-tree-best-number-leaves.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section><section id="classification" class="level4"><h4 class="anchored" data-anchor-id="classification">Classification</h4>
<p>For a classification tree, we predict that each observation belongs to the most <em>commonly occurring class</em> of training observations in the region to which it belongs.</p>
<p>As we can not use RSS as a criterion for making the binary splits, the <strong>classification error rate</strong> could the fraction of the training observations in that region that do not belong to the most common class (<span class="math inline">\(1 - \max_k(\hat{p}_{mk})\)</span>), but it turns out that classification error is not sufficiently sensitive for tree-growing and we use the next metrics as they are more sensitive to <strong>node purity</strong> (<em>proportion of the main class on each terminal node</em>):</p>
<table class="table">
<colgroup>
<col style="width: 36%">
<col style="width: 63%">
</colgroup>
<thead><tr class="header">
<th style="text-align: left;">Name</th>
<th style="text-align: center;">Formula</th>
</tr></thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>Gini index</strong></td>
<td style="text-align: center;"><span class="math inline">\(G = \sum_{k = 1}^K 1 - \hat{p}_{mk} (1 -\hat{p}_{mk})\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>Entropy</strong></td>
<td style="text-align: center;"><span class="math inline">\(D = -\sum_{k = 1}^K 1 - \hat{p}_{mk} \log \hat{p}_{mk}\)</span></td>
</tr>
</tbody>
</table>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/50-tree-classification-example.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section><section id="coding-example-1" class="level4"><h4 class="anchored" data-anchor-id="coding-example-1">Coding example</h4>
<p>https://app.datacamp.com/learn/tutorials/decision-trees-R</p>
<div class="cell">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># For data maninulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com">data.table</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For modeling and visualization</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">#</span></span>
<span><span class="va">Boston</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="fu">MASS</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/MASS/man/Boston.html">Boston</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu">pillar</span><span class="fu">::</span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">Boston</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 506
Columns: 14
$ crim    &lt;dbl&gt; 0.00632, 0.02731, 0.02729, 0.03237, 0.06905, 0.02985, 0.08829,…
$ zn      &lt;dbl&gt; 18.0, 0.0, 0.0, 0.0, 0.0, 0.0, 12.5, 12.5, 12.5, 12.5, 12.5, 1…
$ indus   &lt;dbl&gt; 2.31, 7.07, 7.07, 2.18, 2.18, 2.18, 7.87, 7.87, 7.87, 7.87, 7.…
$ chas    &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ nox     &lt;dbl&gt; 0.538, 0.469, 0.469, 0.458, 0.458, 0.458, 0.524, 0.524, 0.524,…
$ rm      &lt;dbl&gt; 6.575, 6.421, 7.185, 6.998, 7.147, 6.430, 6.012, 6.172, 5.631,…
$ age     &lt;dbl&gt; 65.2, 78.9, 61.1, 45.8, 54.2, 58.7, 66.6, 96.1, 100.0, 85.9, 9…
$ dis     &lt;dbl&gt; 4.0900, 4.9671, 4.9671, 6.0622, 6.0622, 6.0622, 5.5605, 5.9505…
$ rad     &lt;int&gt; 1, 2, 2, 3, 3, 3, 5, 5, 5, 5, 5, 5, 5, 4, 4, 4, 4, 4, 4, 4, 4,…
$ tax     &lt;dbl&gt; 296, 242, 242, 222, 222, 222, 311, 311, 311, 311, 311, 311, 31…
$ ptratio &lt;dbl&gt; 15.3, 17.8, 17.8, 18.7, 18.7, 18.7, 15.2, 15.2, 15.2, 15.2, 15…
$ black   &lt;dbl&gt; 396.90, 396.90, 392.83, 394.63, 396.90, 394.12, 395.60, 396.90…
$ lstat   &lt;dbl&gt; 4.98, 9.14, 4.03, 2.94, 5.33, 5.21, 12.43, 19.15, 29.93, 17.10…
$ medv    &lt;dbl&gt; 24.0, 21.6, 34.7, 33.4, 36.2, 28.7, 22.9, 27.1, 16.5, 18.9, 15…</code></pre>
</div>
</div>
</section></section><section id="bagging-bootstrap-aggregation" class="level3" data-number="7.5.2"><h3 data-number="7.5.2" class="anchored" data-anchor-id="bagging-bootstrap-aggregation">
<span class="header-section-number">7.5.2</span> Bagging (bootstrap aggregation)</h3>
<p>As we said before, simple trees has a <em>high variance</em> problem <span class="math inline">\(Var(\hat{f}(x_{0}))\)</span> and <strong>bagging</strong> can help to mitigate this problem.</p>
<p>We know from the <em>Central Limit Theorem</em> a natural way to <em>reduce the variance</em> and <em>increase the test set accuracy</em> is taking many <strong>training sets from the population</strong>, build a separate prediction model using each training set, and average the resulting prediction, as for a given a set of <span class="math inline">\(n\)</span> <strong>independent observations</strong> <span class="math inline">\(Z_1, \dots, Z_n\)</span>, each with variance <span class="math inline">\(\sigma^2\)</span>, the variance of the mean <span class="math inline">\(\overline{Z}\)</span> of the observations is given by <span class="math inline">\(\sigma^2/n\)</span>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/66-bagging-concept.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>As we generally do not have access to multiple training sets we use <strong>bootstrap</strong> to take repeated samples from the one training data set, train <span class="math inline">\(B\)</span> <strong>not pruned regression trees</strong> and <strong>average</strong> the resulting predictions or select the most commonly occurring class among the <span class="math inline">\(B\)</span> predictions in classification settings.</p>
<p><span class="math display">\[
\hat{f}_{bag}(x) = \frac{1}{B}\sum_{b=1}^B\hat{f}^{*b}(x)
\]</span></p>
<p>The <strong>number of trees is not a critical</strong> as <span class="math inline">\(B\)</span> will not lead to overfitting. Using <span class="math inline">\(B = 100\)</span> is sufficient to achieve good performance in this example.</p>
<section id="out-of-bag-error-estimation" class="level4"><h4 class="anchored" data-anchor-id="out-of-bag-error-estimation">Out-of-bag error estimation</h4>
<p>To estimate the test error as an approximation of the <em>Leave-one-out cross validation</em> when <span class="math inline">\(B\)</span> sufficiently large, we can take advantage of the <span class="math inline">\(1/3\)</span> of observation that were <strong>out-of-bag</strong> (OOB) on each re-sample and predict the response for the <span class="math inline">\(i\)</span>th observation using each of the trees in which that observation was OOB.</p>
<p>This will yield around <span class="math inline">\(B/3\)</span> predictions for each of the <span class="math inline">\(n\)</span> observation that we can <em>average</em> or take a <em>majority</em> vote to calculate the <em>test error</em>.</p>
</section><section id="variable-importance-measures" class="level4"><h4 class="anchored" data-anchor-id="variable-importance-measures">Variable importance measures</h4>
<p>After using this method, we can’t represent the statistical learning procedure using a single tree, instead we can use the <em>RSS</em> (or the <em>Gini index</em>) to record the total amount that the RSS is decreased due to splits over a given predictor, averaged(or added) over all <span class="math inline">\(B\)</span> trees where a large value indicates an important predictor.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/51-bagging-variable-importance.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section></section><section id="random-forests" class="level3" data-number="7.5.3"><h3 data-number="7.5.3" class="anchored" data-anchor-id="random-forests">
<span class="header-section-number">7.5.3</span> Random Forests</h3>
<p>Predictions from the bagged trees, has a big problem, there are <strong>highly correlated</strong> and averaging many highly correlated quantities does not lead to as large of a reduction in variance as averaging many <strong>uncorrelated quantities</strong> (<em>independent</em>).</p>
<p>To solve this problem <strong>Random Forests</strong> provide an improvement over bagged trees by <strong>decorrelates the trees</strong>. As in bagging, we build many trees based on bootstrapped training samples. But when building these decision trees <em>random forest</em> sample <span class="math inline">\(m \approx \sqrt{p}\)</span> predictors to create <span class="math inline">\(B\)</span> *independent trees, making the average of the resulting trees less variable and hence more reliable.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/52-random-forest-effect-over-bagging.png" class="img-fluid figure-img"></p>
</figure>
</div>
<section id="parameters-to-tune" class="level4"><h4 class="anchored" data-anchor-id="parameters-to-tune">Parameters to tune</h4>
<p>Random forests have the least variability in their prediction accuracy when tuning, as the <strong>default values tend to produce good results</strong>.</p>
<ol type="1">
<li>
<strong>Number of trees</strong> (<span class="math inline">\(B\)</span>): A good rule of thumb is to <strong>start with 10 times the number of features</strong> as the error estimate converges after some trees and computation time increases linearly with the number of trees.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/71-ramdom-forest-tuning-number-of-trees.png" class="img-fluid figure-img"></p>
</figure>
</div>
<ol start="2" type="1">
<li>
<strong>Number of predictors</strong> (<span class="math inline">\(m_{try}\)</span>): In <code>ranger</code>, <span class="math inline">\(m_{try} = \text{floor} \left( \frac{p}{3} \right)\)</span> in regression problems and <span class="math inline">\(m_{try} = \text{floor} \left( \sqrt{p} \right)\)</span> in classifications problems, but we can explore in the range <span class="math inline">\([2,p]\)</span>.</li>
</ol>
<ul>
<li>With <strong>few</strong> relevant predictors (e.g., noisy data) a <strong>higher number tends to perform better</strong> because it makes it more likely to <em>select those features with the strongest signal</em>.</li>
<li>With <strong>many</strong> relevant predictors a <strong>lower number might perform better</strong>.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/72-ramdom-forest-tuning-number-of-predictors.png" class="img-fluid figure-img"></p>
</figure>
</div>
<ol start="3" type="1">
<li>
<strong>Tree complexity</strong> (<em>node size</em>): The default values of <span class="math inline">\(1\)</span> for classification and <span class="math inline">\(5\)</span> for regression as these values tend to produce good results, but:</li>
</ol>
<ul>
<li>If your data has <strong>many noisy predictors</strong> and a <strong>high number of trees</strong>, then performance may improve by <strong>increasing node size</strong> (i.e., decreasing tree depth and complexity).</li>
<li>If <strong>computation time is a concern</strong> then you can often decrease run time substantially by <strong>increasing the node size</strong>.</li>
</ul>
<p>Start with three values between 1–10 and adjust depending on impact to accuracy and run time.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/73-ramdom-forest-tuning-node-size.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section></section><section id="boosting" class="level3" data-number="7.5.4"><h3 data-number="7.5.4" class="anchored" data-anchor-id="boosting">
<span class="header-section-number">7.5.4</span> Boosting</h3>
<p>As well as <strong>bagging</strong>, <strong>boosting</strong> is a general approach that can be be applied to many statistical learning methods for regression or classification. Both methods create many models in order to create a single prediction <span class="math inline">\(\hat{f}^1, \dots, \hat{f}^B\)</span>.</p>
<p>To create boosting trees, in general, we need to create then <strong><em>sequentially</em></strong> by using information from prior models and fit a new model with a modified version of the original data set. To be more specific we need to flow the following steps:</p>
<ol type="1">
<li><p>Set <span class="math inline">\(\hat{f}(x) = 0\)</span> and <span class="math inline">\(r_i=y_i\)</span> for all <span class="math inline">\(i\)</span> in the training set.</p></li>
<li><p>For <span class="math inline">\(b = 1, 2, \dots, B\)</span>, repeat the next process:</p></li>
</ol>
<ul>
<li>Fit a tree <span class="math inline">\(\hat{f}^b\)</span> with d splits (d + 1 terminal nodes) to the training data (<span class="math inline">\(X,r\)</span>). In this step is very import to see that we are fitting the new model based on the residuals.</li>
<li>Update <span class="math inline">\(\hat{f}\)</span> by adding in a shrunken version of the new tree:</li>
</ul>
<p><span class="math display">\[
\hat{f}(x) \leftarrow \hat{f}(x) + \lambda \hat{f}^b(x)
\]</span></p>
<ul>
<li>Update the residuals</li>
</ul>
<p><span class="math display">\[
r_i \leftarrow r_i - \lambda \hat{f}^b(x_i)
\]</span></p>
<ol start="3" type="1">
<li>Calculate the output of the boosting model by:</li>
</ol>
<p><span class="math display">\[
\hat{f}(x) = \sum_{b=1}^B \lambda \hat{f}^b(x)
\]</span></p>
<p>As result, our model <em>learn slowly</em> by adding new decision trees into the fitted function in order to update the residuals on each step. As we are going to use many models, each individual model can be small by using a low <span class="math inline">\(d\)</span> parameter. In general, statistical learning approaches that learn slowly tend to perform well.</p>
<section id="parameters-to-tune-1" class="level4"><h4 class="anchored" data-anchor-id="parameters-to-tune-1">Parameters to tune</h4>
<ul>
<li><p><strong>Number of trees</strong> (<span class="math inline">\(B\)</span>): Unlike bagging and random forests, boosting can overfit if B is too large.</p></li>
<li><p><strong>shrinkage</strong> (<span class="math inline">\(\lambda\)</span>): Controls the rate at which boosting learns, it should be a positive value its values are <span class="math inline">\(0.01\)</span> or <span class="math inline">\(0.001\)</span>. Very small <span class="math inline">\(\lambda\)</span> can require using a very large value of B in order to achieve good performance.</p></li>
<li><p><strong>Number of splits or interaction depth</strong> (<span class="math inline">\(d\)</span>): It controls the complexity of the boosted ensemble. When <span class="math inline">\(d=1\)</span> is known as a <strong>stump tree</strong> as each term involves only <em>a single variable</em>. Some times, stump tree works well and are eraser to interpret, but as <span class="math inline">\(d\)</span> increases the <em>number of variables</em> used by each model increases, with <span class="math inline">\(d\)</span> as limit.</p></li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/53-boosting-vs-random-forest.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section></section><section id="bayesian-additive-regression-trees-bart" class="level3" data-number="7.5.5"><h3 data-number="7.5.5" class="anchored" data-anchor-id="bayesian-additive-regression-trees-bart">
<span class="header-section-number">7.5.5</span> Bayesian additive regression trees (BART)</h3>
<p>This method constructs trees in a random manner as in bagging and random forests, and each tree tries to capture signal not yet accounted for by the current model, as in boosting.</p>
<p>To understand the method works we need to define some important notation:</p>
<ul>
<li>
<span class="math inline">\(K\)</span>: Number of regression trees. For example <span class="math inline">\(K\)</span> could be <span class="math inline">\(100\)</span>
</li>
<li>
<span class="math inline">\(B\)</span>: Number of iterations. For example <span class="math inline">\(B\)</span> could be <span class="math inline">\(1000\)</span>
</li>
<li>
<span class="math inline">\(\hat{f}_k^b(x)\)</span>: The prediction at <span class="math inline">\(x\)</span> for the <span class="math inline">\(k\)</span>th regression tree used in the <span class="math inline">\(b\)</span>th iteration</li>
<li>
<span class="math inline">\(\hat{f}^b(x) = \sum_{k=1}^K \hat{f}_k^b(x)\)</span>: Summed of the <span class="math inline">\(K\)</span> at the end of each iteration.</li>
</ul>
<p>To apply this method we need to follow the below steps:</p>
<ol type="1">
<li>In the first iteration all trees are initialized to have a single root node,<em>the mean of the response values divided by the total number of trees</em>, in other to predict the mean of <span class="math inline">\(y\)</span> in the first iteration <span class="math inline">\(\hat{f}^1(x)\)</span>.</li>
</ol>
<p><span class="math display">\[
\hat{f}_k^1(x) = \frac{1}{nK} \sum_{i=1}^n y_i
\]</span></p>
<ol start="2" type="1">
<li>Compute the predictions of the first iteration.</li>
</ol>
<p><span class="math display">\[
\hat{f}^1(x) = \sum_{k=1}^K \hat{f}_k^1(x) = \frac{1}{n} \sum_{i=1}^n y_i
\]</span></p>
<ol start="3" type="1">
<li>For each of the following iterations <span class="math inline">\(b = 2, \dots, B\)</span>.</li>
</ol>
<ul>
<li>
<p>Update each tree <span class="math inline">\(k = 1, 2, \dots, K\)</span> by:</p>
<ul>
<li>Computing a <strong>partial residual</strong> for each tree with all trees but the <span class="math inline">\(k\)</span>th tree.</li>
</ul>
</li>
</ul>
<p><span class="math display">\[
r_i = y_i - \sum_{k'&lt;k} \hat{f}_{k'}^b(x_i) - \sum_{k'&gt;k} \hat{f}_{k'}^{b-1}(x_i)
\]</span></p>
<ul>
<li><ul>
<li>Based on the <em>partial residual</em> BART <strong>randomly choosing a perturbation to the tree</strong> from the previous iteration <span class="math inline">\(\hat{f}_k^{b-1}\)</span> from a set of possible perturbations (adding branches, prunning branches or changing the prediction of terminal nodes) favoring ones that improve the fit to the partial residual. This guards against overfitting since it limits how “hard” we fit the data in each iteration.</li>
</ul></li>
<li>Compute <span class="math inline">\(\hat{f}^b(x) = \sum_{k=1}^K \hat{f}_k^b(x)\)</span>
</li>
</ul>
<ol start="4" type="1">
<li>Compute the <em>mean</em> or a <em>percentile</em> after <span class="math inline">\(L\)</span> burn-in iterations that don’t provide good results. For example <span class="math inline">\(L\)</span> could be <span class="math inline">\(200\)</span>
</li>
</ol>
<p><span class="math display">\[
\hat{f}(x) = \frac{1}{B-L} \sum_{b=L+1}^B \hat{f}(x)
\]</span></p>
<p>This models works really well even without a tuning process and the random process modifications protects the metho to overfit as we increase the number of iterations, as we can see in the next chart.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/54-bart-vs-boosting-trees.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section></section><section id="support-vector-machine" class="level2" data-number="7.6"><h2 data-number="7.6" class="anchored" data-anchor-id="support-vector-machine">
<span class="header-section-number">7.6</span> Support Vector Machine</h2>
<section id="maximal-margin-classifier-hard-margin-classifier" class="level3" data-number="7.6.1"><h3 data-number="7.6.1" class="anchored" data-anchor-id="maximal-margin-classifier-hard-margin-classifier">
<span class="header-section-number">7.6.1</span> Maximal Margin Classifier <em>(Hard Margin Classifier)</em>
</h3>
<p>In a p-dimensional space, a <strong>hyperplane</strong> is a flat affine subspace of hyperplane dimension <span class="math inline">\(p − 1\)</span>.</p>
<p><span class="math display">\[
f(X)= \beta_0 + \beta_1 X_1 + \beta_2 X_2 + \dots + \beta_p X_p = 0
\]</span></p>
<p>But if a point <span class="math inline">\(X = (X_1, X_3, \dots, X_p)^T\)</span> doesn’t satisfy that equation that equation the point would lies to one or other side the equation: - Over the <em>hyperplane</em> if <span class="math inline">\(\beta_0 + \beta_1 X_1 + \beta_2 X_2 + \dots + \beta_p X_p &gt; 0\)</span> - Under the <em>hyperplane</em> if <span class="math inline">\(\beta_0 + \beta_1 X_1 + \beta_2 X_2 + \dots + \beta_p X_p &lt; 0\)</span></p>
<p>But as we can see below there are several possible <em>hyperplane</em> that could do the job.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/97-hyperplane.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>To solve this problem, we need to find the <strong>maximal margin hyperplane</strong> by computing the perpendicular distance from each training observation to a given separating hyperplane to select the <strong>farthest <em>hyperplane</em> from the training observations</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/98-maximal-margin-hyperplane.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>In the last example the two blue points and the purple point that lie on the dashed lines are the <strong>support vectors</strong> as they “support” the maximal margin hyperplane.</p>
<p>The maximal margin hyperplane is the solution to the next optimization problem where the <strong>associated class labels</strong> <span class="math inline">\(y_1, \dots, y_n \in \{-1, 1\}\)</span>:</p>
<p><span class="math display">\[
\begin{split}
  \underset{\beta_0, \beta_1, \dots, \beta_p}{\text{maximize}} &amp; \; M \\
\text{subject to } &amp;
  \begin{cases}
    \sum_{j=1}^p \beta_{j}^2 = 1 , \\
    y_i(\beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \dots + \beta_p x_{ip}) \geq M , \; i = 1, \dots, n
  \end{cases}
\end{split}
\]</span></p>
<p>As consecuence, the ubicated in the expected side of the hyperplane will satisfafy the next condition.</p>
<p><span class="math display">\[
Y_i \times f(X) &gt; 0
\]</span></p>
<p>This method has two disadvantages:</p>
<ol type="1">
<li>Sometimes there isn’t any possible <em>separating hyperplane</em>.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/99-no-posible-hyperplane.png" class="img-fluid figure-img"></p>
</figure>
</div>
<ol start="2" type="1">
<li>Classifying correctly all of the training can lead to sensitivity to individual observations, returning as a result a overfitted model.</li>
</ol>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/100-hyperplane-sensitivity.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section><section id="support-vector-classifiers-soft-margin-classifier" class="level3" data-number="7.6.2"><h3 data-number="7.6.2" class="anchored" data-anchor-id="support-vector-classifiers-soft-margin-classifier">
<span class="header-section-number">7.6.2</span> Support Vector Classifiers <em>(soft margin classifier)</em>
</h3>
<p>To solve this problem we need to allow that:</p>
<ul>
<li>Some observations will be on the incorrect side of the <em>margin</em> like observations 1 and 8.</li>
<li>Some observations will be on the incorrect side of the <em>hyperplane</em> like observations 11 and 12.</li>
</ul>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/101-soft-margin-classifier.png" class="img-fluid figure-img"></p>
</figure>
</div>
<p>To get that result, we need to solve the next problem:</p>
<p><span class="math display">\[
\begin{split}
\underset{\beta_0, \beta_1, \dots, \beta_p, M}{\text{maximize}} &amp; \; M \\
\text{subject to } &amp;
  \begin{cases}
    \sum_{j=1}^p \beta_{j}^2 = 1 , \\
    y_i(\beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \dots + \beta_p x_{ip}) \geq M (1 - \epsilon_i), \; i = 1, \dots, n \\
    \epsilon_i \geq 0, \\
    \sum_{i=1}^n \epsilon_i \leq C
  \end{cases}
\end{split}
\]</span></p>
<ul>
<li>Where:
<ul>
<li>
<span class="math inline">\(M\)</span> is the width of the margin.</li>
<li>
<span class="math inline">\(\epsilon_1, \dots, \epsilon_n\)</span> are slack variables that allow individual observations to be on the wrong side of the margin or the hyperplane.
<ul>
<li>If <span class="math inline">\(\epsilon_i = 0\)</span> then the <em>i</em>th observation is on the <strong>correct side of the margin</strong>.</li>
<li>If <span class="math inline">\(\epsilon_i &gt; 0\)</span> then the <em>i</em>th observation is on the <strong>wrong side of the margin</strong>.</li>
<li>If <span class="math inline">\(\epsilon_i &gt; 1\)</span> then the <em>i</em>th observation is on the <strong>wrong side of the hyperplane</strong>.</li>
</ul>
</li>
<li>
<span class="math inline">\(C\)</span> is a nonnegative tuning parameter that represents the <strong>budget for the total amount that the margin can be violated</strong> by the n observations. For <span class="math inline">\(C &gt; 0\)</span> no more than <span class="math inline">\(C\)</span> observations can be on the wrong side of the hyperplane.</li>
</ul>
</li>
</ul>
<p>It’s important to point that only observations that either <strong>lie on the margin</strong> or <strong>violate the margin</strong> will <strong>affect the hyperplane</strong>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="img/102-effects-of-changing-C.png" class="img-fluid figure-img"></p>
</figure>
</div>
</section><section id="non-linear-boundaries" class="level3" data-number="7.6.3"><h3 data-number="7.6.3" class="anchored" data-anchor-id="non-linear-boundaries">
<span class="header-section-number">7.6.3</span> Non-linear boundaries</h3>
<p>To extend the <em>Support Vector Classifier</em> to non-lineal settings we need to use functions that quantifies the similarity of two observations, known as <strong>kernels</strong> <span class="math inline">\(K(x_i, x_{i'})\)</span> and implement it to the <strong>hyperplane</strong> function for the <em>support vectors</em> <span class="math inline">\(\mathcal{S}\)</span>.</p>
<p><span class="math display">\[
f(x) = \beta_0 + \sum_{i \in \mathcal{S}}  K(x_i, x_{i'})
\]</span> And depending on the shape that we want to use there are some types of kernels to use and we need to <strong>tune the related hyperparameters</strong>. Each of the next kernels is linked to a function in <code>tidymodels</code>and in the documentation of each function we will see the parameters to tune for each case</p>
<section id="polynomial-svm_poly" class="level4"><h4 class="anchored" data-anchor-id="polynomial-svm_poly">Polynomial (<code>svm_poly</code>)</h4>
<p>As the degree <span class="math inline">\(d\)</span> increases the fit becomes more non-linear.</p>
<p><span class="math display">\[
K(x_i, x_{i'}) = \alpha_i (1 + \sum_{j=1}^p x_{ij} x_{i'j})^d
\]</span></p>
</section><section id="radial-svm_rbf" class="level4"><h4 class="anchored" data-anchor-id="radial-svm_rbf">Radial (<code>svm_rbf</code>)</h4>
<p>As <span class="math inline">\(\gamma\)</span> increases the fit becomes more non-linear.</p>
<p><span class="math display">\[
K(x_i, x_{i'}) = \exp(-\gamma \sum_{j=1}^p(x_{ij}-x_{i'j})^2)
\]</span></p>
</section><section id="hyperbolic-tangent" class="level4"><h4 class="anchored" data-anchor-id="hyperbolic-tangent">Hyperbolic tangent</h4>
<p><span class="math display">\[
K(x_i, x_{i'}) = \tanh(k_1||x_i-x_{i'}|| + k_2)
\]</span></p>
<p>There isn’t any function to use this kernel but we can change the default kernel in the <code>set_engine</code> function</p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">svm_tanh</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/svm_linear.html">svm_linear</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html">set_mode</a></span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span><span class="op">(</span><span class="st">"kernlab"</span>,</span>
<span>             kernel <span class="op">=</span> <span class="st">"tanhdot"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section><section id="extending-svms-to-the-k-class-case" class="level3" data-number="7.6.4"><h3 data-number="7.6.4" class="anchored" data-anchor-id="extending-svms-to-the-k-class-case">
<span class="header-section-number">7.6.4</span> Extending SVMs to the K-class case</h3>
<p>To extend this method we have 2 alternatives:</p>
<ul>
<li><p><strong>One-Versus-One Classification (OVO)</strong>: It constructs <span class="math inline">\(\left( \begin{array}{c} K \\ 2 \end{array} \right)\)</span>, tallys the number of times that the test observation is assigned to each of the <span class="math inline">\(K\)</span>. The final classification is performed by assigning the test observation to the class to which it was most frequently assigned.</p></li>
<li><p><strong>One-Versus-All Classification (OVA)</strong>: We fit <span class="math inline">\(K\)</span> SVMs, each time comparing one of the <span class="math inline">\(K\)</span> classes to the remaining <span class="math inline">\(K − 1\)</span> classes. Let <span class="math inline">\(\beta = \beta_{0k}, \beta_{1k}, \dots, \beta_{pk}\)</span> denote the parameters that result from fitting an SVM comparing the <span class="math inline">\(k\)</span>th class (coded as <span class="math inline">\(+1\)</span>) to the others (coded as <span class="math inline">\(−1\)</span>). We assign the observation to the class for which the lineal combination of coefficients and the test observation <span class="math inline">\(\beta x^*\)</span> is largest.</p></li>
</ul>
<div class="callout callout-style-simple callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Kernlab support many classes
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>kernlab</code> package support many classes by default so we don’t need to worry about this problem problem.</p>
</div>
</div>
</section><section id="coding-example-2" class="level3" data-number="7.6.5"><h3 data-number="7.6.5" class="anchored" data-anchor-id="coding-example-2">
<span class="header-section-number">7.6.5</span> Coding Example</h3>
<ol type="1">
<li>Load libraries</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.statlearning.com">ISLR</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">kernlab</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_light</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">sim_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span></span>
<span>  x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">40</span><span class="op">)</span>,</span>
<span>  x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">40</span><span class="op">)</span>,</span>
<span>  y  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">y</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">x1</span> <span class="op">+</span> <span class="fl">1.5</span>, <span class="va">x1</span><span class="op">)</span>,</span>
<span>         x2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">y</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">x2</span> <span class="op">+</span> <span class="fl">1.5</span>, <span class="va">x2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">sim_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">x1</span>, <span class="va">x2</span>, color <span class="op">=</span> <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07-non-parametric-models_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<ol start="2" type="1">
<li>Define model specification</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">svm_linear_spec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://parsnip.tidymodels.org/reference/svm_poly.html">svm_poly</a></span><span class="op">(</span>degree <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html">set_mode</a></span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># We don't need scaling for now</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html">set_engine</a></span><span class="op">(</span><span class="st">"kernlab"</span>, scaled <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol start="3" type="1">
<li>Fitting the model and checking results</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">svm_linear_fit</span> <span class="op">&lt;-</span> <span class="va">svm_linear_spec</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html">set_args</a></span><span class="op">(</span>cost <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html">fit</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">sim_data</span><span class="op">)</span></span>
<span></span>
<span><span class="va">svm_linear_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://hardhat.tidymodels.org/reference/hardhat-extract.html">extract_fit_engine</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="07-non-parametric-models_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./06-generative-classification-models.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Generative Models for Classiﬁcation</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./08-survival-analysis.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Time-event (Survival) Analysis and Censored Data</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">This book was built with <a href="https://quarto.org/">Quarto</a>.</div>
  </div>
</footer>


</body></html>